<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeminiGuard | Supply Chain Security</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-50 min-h-screen flex flex-col items-center py-10">

    <div class="w-full max-w-4xl px-4">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">
                GeminiGuard</h1>
            <p class="text-slate-400 mt-2">AI-Powered Supply Chain Security Auditor</p>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-700">
            <label class="block text-sm font-medium text-slate-300 mb-2">Paste requirements.txt or package.json</label>
            <textarea id="dependencyInput" rows="8"
                class="w-full bg-slate-900 text-emerald-400 font-mono text-sm p-4 rounded-lg border border-slate-600 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                placeholder="flask==0.12&#10;requests==2.25.1&#10;pandoas==1.0.0"></textarea>

            <button onclick="analyzeDependencies()" id="scanBtn"
                class="mt-4 w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all flex justify-center items-center">
                <span>Scan Dependencies</span>
            </button>
        </div>

        <div id="resultsArea" class="hidden mt-8 space-y-6">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div
                    class="col-span-1 bg-slate-800 p-6 rounded-xl border border-slate-700 flex flex-col items-center justify-center">
                    <span class="text-slate-400 text-sm uppercase tracking-wider">Health Score</span>
                    <span id="scoreDisplay" class="text-6xl font-bold text-white mt-2">--</span>
                </div>
                <div
                    class="col-span-2 bg-slate-800 p-6 rounded-xl border border-slate-700 flex flex-col justify-center">
                    <h3 class="text-lg font-semibold text-blue-400">Analysis Summary</h3>
                    <p id="summaryDisplay" class="text-slate-300 mt-2">...</p>
                </div>
            </div>

            <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                <div class="p-4 bg-slate-700/50 border-b border-slate-700">
                    <h3 class="font-semibold text-red-400">Critical Risks Detected</h3>
                </div>
                <div class="p-4">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-slate-400 text-sm border-b border-slate-700">
                                <th class="p-2">Package</th>
                                <th class="p-2">Level</th>
                                <th class="p-2">Issue</th>
                                <th class="p-2">Fix Suggestion</th>
                            </tr>
                        </thead>
                        <tbody id="riskTableBody" class="text-sm">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function analyzeDependencies() {
            const input = document.getElementById('dependencyInput').value;
            const btn = document.getElementById('scanBtn');
            const results = document.getElementById('resultsArea');

            if (!input.trim()) return alert("Please paste some dependencies first.");

            // UI Loading State
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 mr-3 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg> Scanning...`;
            btn.disabled = true;

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dependencies: input })
                });

                const data = await response.json();

                if (data.error) throw new Error(data.error);

                renderResults(data);
            } catch (err) {
                alert("Error: " + err.message);
            } finally {
                btn.innerHTML = "Scan Dependencies";
                btn.disabled = false;
            }
        }

        function renderResults(data) {
            document.getElementById('resultsArea').classList.remove('hidden');

            // Set Score Color
            const score = data.project_health_score;
            const scoreEl = document.getElementById('scoreDisplay');
            scoreEl.innerText = score;
            scoreEl.className = `text-6xl font-bold mt-2 ${score > 80 ? 'text-emerald-400' : score > 50 ? 'text-yellow-400' : 'text-red-500'}`;

            document.getElementById('summaryDisplay').innerText = data.summary;

            // Render Table
            const tbody = document.getElementById('riskTableBody');
            tbody.innerHTML = '';

            if (data.critical_risks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-emerald-400">No critical risks found. Good job!</td></tr>';
            } else {
                data.critical_risks.forEach(risk => {
                    const row = `
                        <tr class="border-b border-slate-700 hover:bg-slate-700/30">
                            <td class="p-2 font-mono text-white">${risk.package_name}</td>
                            <td class="p-2"><span class="px-2 py-1 rounded text-xs font-bold ${risk.risk_level === 'CRITICAL' ? 'bg-red-900 text-red-200' : 'bg-yellow-900 text-yellow-200'}">${risk.risk_level}</span></td>
                            <td class="p-2 text-slate-300">${risk.issue}</td>
                            <td class="p-2 text-emerald-400">${risk.fix_suggestion}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            }
        }
    </script>
</body>

</html>